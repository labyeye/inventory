<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=0"
    />
    <meta name="description" content="POS - Bootstrap Admin Template" />
    <meta
      name="keywords"
      content="admin, estimates, bootstrap, business, corporate, creative, invoice, html5, responsive, Projects"
    />
    <meta name="author" content="Dreamguys - Bootstrap Admin Template" />
    <meta name="robots" content="noindex, nofollow" />
    <title>Dreams Pos admin template</title>

    <link
      rel="shortcut icon"
      type="image/x-icon"
      href="assets/img/favicon.png"
    />

    <link rel="stylesheet" href="assets/css/bootstrap.min.css" />

    <link rel="stylesheet" href="assets/css/animate.css" />

    <link rel="stylesheet" href="assets/plugins/select2/css/select2.min.css" />

    <link rel="stylesheet" href="assets/css/dataTables.bootstrap4.min.css" />

    <link
      rel="stylesheet"
      href="assets/plugins/fontawesome/css/fontawesome.min.css"
    />
    <link rel="stylesheet" href="assets/plugins/fontawesome/css/all.min.css" />

    <link rel="stylesheet" href="assets/css/style.css" />
  </head>
  <body>
    <div id="global-loader">
      <div class="whirly-loader"></div>
    </div>

    <div class="main-wrapper">
      <div class="header">
        <div class="header-left active">
          <a href="index.html" class="logo">
            <img src="assets/img/logo.png" alt="" />
          </a>
          <a href="index.html" class="logo-small">
            <img src="assets/img/logo-small.png" alt="" />
          </a>
          <a id="toggle_btn" href="javascript:void(0);"> </a>
        </div>

        <a id="mobile_btn" class="mobile_btn" href="#sidebar">
          <span class="bar-icon">
            <span></span>
            <span></span>
            <span></span>
          </span>
        </a>

        <ul class="nav user-menu">
          <li class="nav-item">
            <div class="top-nav-search">
              <a href="javascript:void(0);" class="responsive-search">
                <i class="fa fa-search"></i>
              </a>
              <form action="#">
                <div class="searchinputs">
                  <input type="text" placeholder="Search Here ..." />
                  <div class="search-addon">
                    <span
                      ><img src="assets/img/icons/closes.svg" alt="img"
                    /></span>
                  </div>
                </div>
                <a class="btn" id="searchdiv"
                  ><img src="assets/img/icons/search.svg" alt="img"
                /></a>
              </form>
            </div>
          </li>

          <li class="nav-item dropdown has-arrow flag-nav">
            <a
              class="nav-link dropdown-toggle"
              data-bs-toggle="dropdown"
              href="javascript:void(0);"
              role="button"
            >
              <img src="assets/img/flags/us1.png" alt="" height="20" />
            </a>
            <div class="dropdown-menu dropdown-menu-right">
              <a href="javascript:void(0);" class="dropdown-item">
                <img src="assets/img/flags/us.png" alt="" height="16" /> English
              </a>
              <a href="javascript:void(0);" class="dropdown-item">
                <img src="assets/img/flags/fr.png" alt="" height="16" /> French
              </a>
              <a href="javascript:void(0);" class="dropdown-item">
                <img src="assets/img/flags/es.png" alt="" height="16" /> Spanish
              </a>
              <a href="javascript:void(0);" class="dropdown-item">
                <img src="assets/img/flags/de.png" alt="" height="16" /> German
              </a>
            </div>
          </li>

          <li class="nav-item dropdown">
            <a
              href="javascript:void(0);"
              class="dropdown-toggle nav-link"
              data-bs-toggle="dropdown"
            >
              <img src="assets/img/icons/notification-bing.svg" alt="img" />
              <span class="badge rounded-pill">4</span>
            </a>
            <div class="dropdown-menu notifications">
              <div class="topnav-dropdown-header">
                <span class="notification-title">Notifications</span>
                <a href="javascript:void(0)" class="clear-noti"> Clear All </a>
              </div>
              <div class="noti-content">
                <ul class="notification-list">
                  <li class="notification-message">
                    <a href="activities.html">
                      <div class="media d-flex">
                        <span class="avatar flex-shrink-0">
                          <img alt="" src="assets/img/profiles/avatar-02.jpg" />
                        </span>
                        <div class="media-body flex-grow-1">
                          <p class="noti-details">
                            <span class="noti-title">John Doe</span> added new
                            task
                            <span class="noti-title"
                              >Patient appointment booking</span
                            >
                          </p>
                          <p class="noti-time">
                            <span class="notification-time">4 mins ago</span>
                          </p>
                        </div>
                      </div>
                    </a>
                  </li>
                  <li class="notification-message">
                    <a href="activities.html">
                      <div class="media d-flex">
                        <span class="avatar flex-shrink-0">
                          <img alt="" src="assets/img/profiles/avatar-03.jpg" />
                        </span>
                        <div class="media-body flex-grow-1">
                          <p class="noti-details">
                            <span class="noti-title">Tarah Shropshire</span>
                            changed the task name
                            <span class="noti-title"
                              >Appointment booking with payment gateway</span
                            >
                          </p>
                          <p class="noti-time">
                            <span class="notification-time">6 mins ago</span>
                          </p>
                        </div>
                      </div>
                    </a>
                  </li>
                  <li class="notification-message">
                    <a href="activities.html">
                      <div class="media d-flex">
                        <span class="avatar flex-shrink-0">
                          <img alt="" src="assets/img/profiles/avatar-06.jpg" />
                        </span>
                        <div class="media-body flex-grow-1">
                          <p class="noti-details">
                            <span class="noti-title">Misty Tison</span> added
                            <span class="noti-title">Domenic Houston</span> and
                            <span class="noti-title">Claire Mapes</span> to
                            project
                            <span class="noti-title"
                              >Doctor available module</span
                            >
                          </p>
                          <p class="noti-time">
                            <span class="notification-time">8 mins ago</span>
                          </p>
                        </div>
                      </div>
                    </a>
                  </li>
                  <li class="notification-message">
                    <a href="activities.html">
                      <div class="media d-flex">
                        <span class="avatar flex-shrink-0">
                          <img alt="" src="assets/img/profiles/avatar-17.jpg" />
                        </span>
                        <div class="media-body flex-grow-1">
                          <p class="noti-details">
                            <span class="noti-title">Rolland Webber</span>
                            completed task
                            <span class="noti-title"
                              >Patient and Doctor video conferencing</span
                            >
                          </p>
                          <p class="noti-time">
                            <span class="notification-time">12 mins ago</span>
                          </p>
                        </div>
                      </div>
                    </a>
                  </li>
                  <li class="notification-message">
                    <a href="activities.html">
                      <div class="media d-flex">
                        <span class="avatar flex-shrink-0">
                          <img alt="" src="assets/img/profiles/avatar-13.jpg" />
                        </span>
                        <div class="media-body flex-grow-1">
                          <p class="noti-details">
                            <span class="noti-title">Bernardo Galaviz</span>
                            added new task
                            <span class="noti-title">Private chat module</span>
                          </p>
                          <p class="noti-time">
                            <span class="notification-time">2 days ago</span>
                          </p>
                        </div>
                      </div>
                    </a>
                  </li>
                </ul>
              </div>
              <div class="topnav-dropdown-footer">
                <a href="activities.html">View all Notifications</a>
              </div>
            </div>
          </li>

          <li class="nav-item dropdown has-arrow main-drop">
            <a
              href="javascript:void(0);"
              class="dropdown-toggle nav-link userset"
              data-bs-toggle="dropdown"
            >
              <span class="user-img"
                ><img src="assets/img/profiles/avator1.jpg" alt="" />
                <span class="status online"></span
              ></span>
            </a>
            <div class="dropdown-menu menu-drop-user">
              <div class="profilename">
                <div class="profileset">
                  <span class="user-img"
                    ><img src="assets/img/profiles/avator1.jpg" alt="" />
                    <span class="status online"></span
                  ></span>
                  <div class="profilesets">
                    <h6>John Doe</h6>
                    <h5>Admin</h5>
                  </div>
                </div>
                <hr class="m-0" />
                <a class="dropdown-item" href="profile.html">
                  <i class="me-2" data-feather="user"></i> My Profile</a
                >
                <a class="dropdown-item" href="generalsettings.html"
                  ><i class="me-2" data-feather="settings"></i>Settings</a
                >
                <hr class="m-0" />
                <a class="dropdown-item logout pb-0" href="login.html"
                  ><img
                    src="assets/img/icons/log-out.svg"
                    class="me-2"
                    alt="img"
                  />Logout</a
                >
              </div>
            </div>
          </li>
        </ul>

        <div class="dropdown mobile-user-menu">
          <a
            href="javascript:void(0);"
            class="nav-link dropdown-toggle"
            data-bs-toggle="dropdown"
            aria-expanded="false"
            ><i class="fa fa-ellipsis-v"></i
          ></a>
          <div class="dropdown-menu dropdown-menu-right">
            <a class="dropdown-item" href="profile.html">My Profile</a>
            <a class="dropdown-item" href="generalsettings.html">Settings</a>
            <a class="dropdown-item" href="login.html">Logout</a>
          </div>
        </div>
      </div>

      <div class="sidebar" id="sidebar">
        <div class="sidebar-inner slimscroll">
          <div id="sidebar-menu" class="sidebar-menu">
            <ul>
              <li class="active">
                <a href="index.html"
                  ><img src="assets/img/icons/dashboard.svg" alt="img" /><span>
                    Dashboard</span
                  >
                </a>
              </li>
              <li class="submenu">
                <a href="javascript:void(0);"
                  ><img src="assets/img/icons/product.svg" alt="img" /><span>
                    Inventory</span
                  >
                  <span class="menu-arrow"></span
                ></a>
                <ul>
                  <li><a href="./productlist.html">Inventory List</a></li>
                  <li><a href="./addproduct.html">Add Inventory</a></li>
                  <li><a href="./categorylist.html">Category List</a></li>
                  <li><a href="./addcategory.html">Add Category</a></li>
                  <li>
                    <a href="./subcategorylist.html">Sub Category List</a>
                  </li>
                  <li><a href="./subaddcategory.html">Add Sub Category</a></li>
                </ul>
              </li>
              <li class="submenu">
                <a href="javascript:void(0);"
                  ><img src="assets/img/icons/sales1.svg" alt="img" /><span>
                    Events</span
                  >
                  <span class="menu-arrow"></span
                ></a>
                <ul>
                  <li><a href="saleslist.html">Events List</a></li>
                  <li><a href="addevent.html">New Event</a></li>
                </ul>
              </li>

              <li class="submenu">
                <a href="javascript:void(0);"
                  ><img src="assets/img/icons/return1.svg" alt="img" /><span>
                    Return</span
                  >
                  <span class="menu-arrow"></span
                ></a>
                <ul>
                  <li>
                    <a href="salesreturnlist.html">Inventory Return List</a>
                  </li>
                  <li>
                    <a href="createsalesreturn.html">Add Inventory Return </a>
                  </li>
                </ul>
              </li>

              <li class="submenu">
                <a href="javascript:void(0);"
                  ><img src="assets/img/icons/time.svg" alt="img" /><span>
                    Report</span
                  >
                  <span class="menu-arrow"></span
                ></a>
                <ul>
                  <li>
                    <a href="./purchaseorderreport.html">Event Order report</a>
                  </li>
                  <li><a href="./inventoryreport.html">Inventory Report</a></li>
                  <li>
                    <a href="./invoicereport.html">Inventory Return Report</a>
                  </li>
                  <li><a href="./purchasereport.html">Purchase Report</a></li>
                </ul>
              </li>
              <li class="submenu">
                <a href="javascript:void(0);"
                  ><img src="assets/img/icons/users1.svg" alt="img" /><span>
                    Users</span
                  >
                  <span class="menu-arrow"></span
                ></a>
                <ul>
                  <li><a href="newuser.html">New User </a></li>
                  <li><a href="userlists.html">Users List</a></li>
                </ul>
              </li>
            </ul>
          </div>
        </div>
      </div>

      <div class="page-wrapper">
        <div class="content">
          <div class="page-header">
            <div class="page-title">
              <h4>Event Add</h4>
              <h6>Create new event</h6>
            </div>
          </div>

          <div class="card">
            <div class="card-body">
              <div class="row">
                <div class="col-lg-4 col-sm-6 col-12">
                  <div class="form-group">
                    <label>Event Name</label>
                    <input type="text" placeholder="Enter Event Name" />
                  </div>
                </div>
                <div class="col-lg-4 col-sm-6 col-12">
                  <div class="form-group">
                    <label>Event Date</label>
                    <input type="date" />
                  </div>
                </div>
                <div class="col-lg-4 col-sm-6 col-12">
                  <div class="form-group">
                    <label>Event Status</label>
                    <select class="select">
                      <option>Upcoming</option>
                      <option>Ongoing</option>
                      <option>Completed</option>
                      <option>Cancelled</option>
                    </select>
                  </div>
                </div>
                <div class="col-lg-12">
                  <div class="form-group">
                    <label>Description</label>
                    <textarea
                      class="form-control"
                      placeholder="Enter Event Description"
                    ></textarea>
                  </div>
                </div>

                <div class="col-lg-12">
                  <div class="card-header">
                    <h5>Product Selection</h5>
                  </div>
                </div>

                <div class="col-lg-4 col-sm-6 col-12">
                  <div class="form-group">
                    <label>Product</label>
                    <select class="select">
                      <option>Select Product</option>
                      <option>Laptop</option>
                      <option>Projector</option>
                      <option>Furniture</option>
                      <option>Sound System</option>
                      <option>Decoration Items</option>
                    </select>
                  </div>
                </div>
                <div class="col-lg-4 col-sm-6 col-12">
                  <div class="form-group">
                    <label>Category</label>
                    <select class="select">
                      <option>Select Category</option>
                      <option>Electronics</option>
                      <option>Furniture</option>
                      <option>Decorations</option>
                      <option>Audio Equipment</option>
                    </select>
                  </div>
                </div>
                <div class="col-lg-4 col-sm-6 col-12">
                  <div class="form-group">
                    <label>Sub Category</label>
                    <select class="select">
                      <option>Select Sub Category</option>
                      <option>Displays</option>
                      <option>Seating</option>
                      <option>Lighting</option>
                      <option>Speakers</option>
                    </select>
                  </div>
                </div>
                <div class="col-lg-4 col-sm-6 col-12">
                  <div class="form-group">
                    <label>Brand</label>
                    <select class="select">
                      <option>Select Brand</option>
                      <option>Dell</option>
                      <option>Sony</option>
                      <option>IKEA</option>
                      <option>JBL</option>
                    </select>
                  </div>
                </div>
                <div class="col-lg-4 col-sm-6 col-12">
                  <div class="form-group">
                    <label>Quantity</label>
                    <input type="number" placeholder="Enter Quantity" min="1" />
                  </div>
                </div>

                <div class="col-lg-12">
                  <div class="form-group">
                    <label>Product Requirements Note</label>
                    <textarea
                      class="form-control"
                      placeholder="Special requirements for the products"
                    ></textarea>
                  </div>
                </div>

                <div class="col-lg-12 mt-3">
                  <button id="addProductBtn" class="btn btn-primary">
                    Add Another Product
                  </button>
                </div>

                <div class="col-lg-12 mt-4">
                  <a href="javascript:void(0);" class="btn btn-submit me-2"
                    >Create Event</a
                  >
                  <a href="saleslist.html" class="btn btn-cancel">Cancel</a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="assets/js/jquery-3.6.0.min.js"></script>

    <script src="assets/js/feather.min.js"></script>

    <script src="assets/js/jquery.slimscroll.min.js"></script>

    <script src="assets/js/jquery.dataTables.min.js"></script>
    <script src="assets/js/dataTables.bootstrap4.min.js"></script>

    <script src="assets/js/bootstrap.bundle.min.js"></script>

    <script src="assets/plugins/select2/js/select2.min.js"></script>

    <script src="assets/plugins/sweetalert/sweetalert2.all.min.js"></script>
    <script src="assets/plugins/sweetalert/sweetalerts.min.js"></script>

    <script src="assets/js/script.js"></script>

    <script type="module">
      import { auth, db } from "./assets/js/firebase.js";
      import {
        collection,
        addDoc,
        getDocs,
        query,
        where,
        serverTimestamp,
      } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-firestore.js";

      // Firebase event form submission code
      // Firebase event form submission code
      // Firebase product selection integration
      document.addEventListener("DOMContentLoaded", async function () {
        try {
          // Import Firebase modules
          const { db } = await import("./assets/js/firebase.js");
          const { collection, getDocs, query, where, doc, getDoc } =
            await import(
              "https://www.gstatic.com/firebasejs/11.4.0/firebase-firestore.js"
            );

          // Reference to main form elements
          const mainCategorySelect = document.querySelector(
            ".card-body > .row select.select:nth-of-type(2)"
          );
          const mainSubCategorySelect = document.querySelector(
            ".card-body > .row select.select:nth-of-type(3)"
          );
          const mainProductSelect = document.querySelector(
            ".card-body > .row select.select:nth-of-type(1)"
          );
          const mainBrandSelect = document.querySelector(
            ".card-body > .row select.select:nth-of-type(4)"
          );

          // Clear and initialize selects
          initializeSelect(mainCategorySelect, "Select Category");
          initializeSelect(mainSubCategorySelect, "Select Sub Category");
          initializeSelect(mainProductSelect, "Select Product");
          initializeSelect(mainBrandSelect, "Select Brand");

          // Disable selects initially
          mainSubCategorySelect.disabled = true;
          mainProductSelect.disabled = true;

          // Load categories from Firebase
          await loadCategories(mainCategorySelect);

          // Event listener for category selection
          mainCategorySelect.addEventListener("change", async function () {
            const selectedCategory = this.value;
            if (selectedCategory && selectedCategory !== "Select Category") {
              // Reset subsequent dropdowns
              initializeSelect(mainSubCategorySelect, "Select Sub Category");
              initializeSelect(mainProductSelect, "Select Product");

              // Enable subcategory dropdown and load options
              mainSubCategorySelect.disabled = false;
              await loadSubcategories(mainSubCategorySelect, selectedCategory);

              // Disable product dropdown until subcategory is selected
              mainProductSelect.disabled = true;
            } else {
              // Reset and disable subsequent dropdowns
              initializeSelect(mainSubCategorySelect, "Select Sub Category");
              initializeSelect(mainProductSelect, "Select Product");
              mainSubCategorySelect.disabled = true;
              mainProductSelect.disabled = true;
            }
          });

          // Event listener for subcategory selection
          mainSubCategorySelect.addEventListener("change", async function () {
            const selectedCategory = mainCategorySelect.value;
            const selectedSubcategory = this.value;

            if (
              selectedSubcategory &&
              selectedSubcategory !== "Select Sub Category"
            ) {
              // Reset product dropdown
              initializeSelect(mainProductSelect, "Select Product");

              // Enable product dropdown and load options
              mainProductSelect.disabled = false;
              await loadProducts(
                mainProductSelect,
                selectedCategory,
                selectedSubcategory
              );
            } else {
              // Reset and disable product dropdown
              initializeSelect(mainProductSelect, "Select Product");
              mainProductSelect.disabled = true;
            }
          });

          // Event listener for product selection
          mainProductSelect.addEventListener("change", async function () {
            const selectedProduct = this.value;

            if (selectedProduct && selectedProduct !== "Select Product") {
              // Load brands associated with the selected product
              await loadBrandsForProduct(mainBrandSelect, selectedProduct);
            } else {
              // Reset brand dropdown
              initializeSelect(mainBrandSelect, "Select Brand");
            }
          });

          // Add product button - add event listeners to new sections
          $("#addProductBtn").click(function () {
            // Wait for the new section to be added to the DOM
            setTimeout(async function () {
              // Get the newly added product section
              const newSection = $(".product-section").last();

              // Get select elements in this section
              const categorySelect = newSection.find("select.select").eq(1);
              const subcategorySelect = newSection.find("select.select").eq(2);
              const productSelect = newSection.find("select.select").eq(0);
              const brandSelect = newSection.find("select.select").eq(3);

              // Initialize selects
              initializeSelect(categorySelect[0], "Select Category");
              initializeSelect(subcategorySelect[0], "Select Sub Category");
              initializeSelect(productSelect[0], "Select Product");
              initializeSelect(brandSelect[0], "Select Brand");

              // Disable selects initially
              subcategorySelect.prop("disabled", true);
              productSelect.prop("disabled", true);

              // Load categories for this section
              await loadCategories(categorySelect[0]);

              // Add event listeners for this section
              setupSectionEventListeners(
                categorySelect[0],
                subcategorySelect[0],
                productSelect[0],
                brandSelect[0]
              );
            }, 100);
          });

          // Function to set up event listeners for a product section
          function setupSectionEventListeners(
            categorySelect,
            subcategorySelect,
            productSelect,
            brandSelect
          ) {
            // Category change event
            $(categorySelect).on("change", async function () {
              const selectedCategory = this.value;
              if (selectedCategory && selectedCategory !== "Select Category") {
                // Reset subsequent dropdowns
                initializeSelect(subcategorySelect, "Select Sub Category");
                initializeSelect(productSelect, "Select Product");

                // Enable subcategory dropdown and load options
                $(subcategorySelect).prop("disabled", false);
                await loadSubcategories(subcategorySelect, selectedCategory);

                // Disable product dropdown until subcategory is selected
                $(productSelect).prop("disabled", true);
              } else {
                // Reset and disable subsequent dropdowns
                initializeSelect(subcategorySelect, "Select Sub Category");
                initializeSelect(productSelect, "Select Product");
                $(subcategorySelect).prop("disabled", true);
                $(productSelect).prop("disabled", true);
              }
            });

            // Subcategory change event
            $(subcategorySelect).on("change", async function () {
              const selectedCategory = $(categorySelect).val();
              const selectedSubcategory = this.value;

              if (
                selectedSubcategory &&
                selectedSubcategory !== "Select Sub Category"
              ) {
                // Reset product dropdown
                initializeSelect(productSelect, "Select Product");

                // Enable product dropdown and load options
                $(productSelect).prop("disabled", false);
                await loadProducts(
                  productSelect,
                  selectedCategory,
                  selectedSubcategory
                );
              } else {
                // Reset and disable product dropdown
                initializeSelect(productSelect, "Select Product");
                $(productSelect).prop("disabled", true);
              }
            });

            // Product change event
            $(productSelect).on("change", async function () {
              const selectedProduct = this.value;

              if (selectedProduct && selectedProduct !== "Select Product") {
                // Load brands associated with the selected product
                await loadBrandsForProduct(brandSelect, selectedProduct);
              } else {
                // Reset brand dropdown
                initializeSelect(brandSelect, "Select Brand");
              }
            });
          }

          // Function to initialize a select element
          function initializeSelect(selectElement, placeholderText) {
            if (!selectElement) return;

            // Clear existing options
            selectElement.innerHTML = "";

            // Add placeholder option
            const placeholderOption = document.createElement("option");
            placeholderOption.textContent = placeholderText;
            placeholderOption.value = "";
            selectElement.appendChild(placeholderOption);

            // Refresh select2 if it's initialized
            try {
              $(selectElement).trigger("change");
            } catch (e) {
              console.log("Select2 not initialized yet");
            }
          }

          // Function to load categories from Firebase
          async function loadCategories(selectElement) {
            if (!selectElement) return;

            // Get categories from Firestore
            const categoriesSnapshot = await getDocs(
              collection(db, "categories")
            );

            // Clear existing options (except placeholder)
            initializeSelect(selectElement, "Select Category");

            // Add categories to select
            categoriesSnapshot.forEach((doc) => {
              const category = doc.data();
              const option = document.createElement("option");
              option.value = doc.id;
              option.textContent = category.name;
              selectElement.appendChild(option);
            });

            // Refresh select2
            try {
              $(selectElement).trigger("change");
            } catch (e) {
              console.log("Select2 not initialized yet");
            }
          }

          // Function to load subcategories based on selected category
          async function loadSubcategories(selectElement, categoryId) {
            if (!selectElement) return;

            // Clear existing options
            initializeSelect(selectElement, "Select Sub Category");

            // Query subcategories for the selected category
            const subcategoriesRef = collection(db, "subcategories");
            const q = query(
              subcategoriesRef,
              where("categoryId", "==", categoryId)
            );
            const subcategoriesSnapshot = await getDocs(q);

            // Add subcategories to select
            subcategoriesSnapshot.forEach((doc) => {
              const subcategory = doc.data();
              const option = document.createElement("option");
              option.value = doc.id;
              option.textContent = subcategory.name;
              selectElement.appendChild(option);
            });

            // Refresh select2
            try {
              $(selectElement).trigger("change");
            } catch (e) {
              console.log("Select2 not initialized yet");
            }
          }

          // Function to load products based on selected category and subcategory
          async function loadProducts(
            selectElement,
            categoryId,
            subcategoryId
          ) {
            if (!selectElement) return;

            // Clear existing options
            initializeSelect(selectElement, "Select Product");

            // Query products for the selected category and subcategory
            const productsRef = collection(db, "products");
            const q = query(
              productsRef,
              where("categoryId", "==", categoryId),
              where("subcategoryId", "==", subcategoryId)
            );
            const productsSnapshot = await getDocs(q);

            // Add products to select
            productsSnapshot.forEach((doc) => {
              const product = doc.data();
              const option = document.createElement("option");
              option.value = doc.id;
              option.textContent = product.name;
              selectElement.appendChild(option);
            });

            // Refresh select2
            try {
              $(selectElement).trigger("change");
            } catch (e) {
              console.log("Select2 not initialized yet");
            }
          }

          // Function to load brands for a product
          async function loadBrandsForProduct(selectElement, productId) {
            if (!selectElement) return;

            // Clear existing options
            initializeSelect(selectElement, "Select Brand");

            // First get the product to access its brandId if it exists
            const productDoc = await getDoc(doc(db, "products", productId));

            if (productDoc.exists() && productDoc.data().brandId) {
              // If product has a specific brand, load just that brand
              const brandId = productDoc.data().brandId;
              const brandDoc = await getDoc(doc(db, "brands", brandId));

              if (brandDoc.exists()) {
                const option = document.createElement("option");
                option.value = brandId;
                option.textContent = brandDoc.data().name;
                selectElement.appendChild(option);
              }
            } else {
              // Otherwise load all available brands
              const brandsSnapshot = await getDocs(collection(db, "brands"));

              brandsSnapshot.forEach((doc) => {
                const brand = doc.data();
                const option = document.createElement("option");
                option.value = doc.id;
                option.textContent = brand.name;
                selectElement.appendChild(option);
              });
            }

            // Refresh select2
            try {
              $(selectElement).trigger("change");
            } catch (e) {
              console.log("Select2 not initialized yet");
            }
          }
        } catch (error) {
          console.error("Error initializing product selection:", error);
          alert(
            "Failed to load product data. Please check your connection and try again."
          );
        }
      });
    </script>

    <script>
      // Function to add another product section
      $(document).ready(function () {
        $("#addProductBtn").click(function () {
          // Clone the product selection section
          const productSection = `
            <div class="row product-section mt-4 pt-3 border-top">
              <div class="col-lg-12">
                <div class="card-header">
                  <h5>Additional Product</h5>
                </div>
              </div>
              
              <div class="col-lg-4 col-sm-6 col-12">
                <div class="form-group">
                  <label>Product</label>
                  <select class="select">
                    <option>Select Product</option>
                    <option>Laptop</option>
                    <option>Projector</option>
                    <option>Furniture</option>
                    <option>Sound System</option>
                    <option>Decoration Items</option>
                  </select>
                </div>
              </div>
              <div class="col-lg-4 col-sm-6 col-12">
                <div class="form-group">
                  <label>Category</label>
                  <select class="select">
                    <option>Select Category</option>
                    <option>Electronics</option>
                    <option>Furniture</option>
                    <option>Decorations</option>
                    <option>Audio Equipment</option>
                  </select>
                </div>
              </div>
              <div class="col-lg-4 col-sm-6 col-12">
                <div class="form-group">
                  <label>Sub Category</label>
                  <select class="select">
                    <option>Select Sub Category</option>
                    <option>Displays</option>
                    <option>Seating</option>
                    <option>Lighting</option>
                    <option>Speakers</option>
                  </select>
                </div>
              </div>
              <div class="col-lg-4 col-sm-6 col-12">
                <div class="form-group">
                  <label>Brand</label>
                  <select class="select">
                    <option>Select Brand</option>
                    <option>Dell</option>
                    <option>Sony</option>
                    <option>IKEA</option>
                    <option>JBL</option>
                  </select>
                </div>
              </div>
              <div class="col-lg-4 col-sm-6 col-12">
                <div class="form-group">
                  <label>Quantity</label>
                  <input type="number" placeholder="Enter Quantity" min="1" />
                </div>
              </div>
              <div class="col-lg-4 col-sm-6 col-12">
                <div class="form-group">
                  <button class="btn btn-danger remove-product">Remove</button>
                </div>
              </div>
            </div>
          `;

          // Insert before the add product button
          $(productSection).insertBefore($("#addProductBtn").parent().parent());

          // Initialize select2 for the new dropdowns
          $(".select").select2();

          // Add remove functionality
          $(".remove-product").click(function () {
            $(this).closest(".product-section").remove();
          });
        });
      });
    </script>
  </body>
</html>
