<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=0"
    />
    <meta name="description" content="POS - Bootstrap Admin Template" />
    <meta
      name="keywords"
      content="admin, estimates, bootstrap, business, corporate, creative, management, minimal, modern,  html5, responsive"
    />
    <meta name="author" content="Dreamguys - Bootstrap Admin Template" />
    <meta name="robots" content="noindex, nofollow" />
    <title>Dreams Pos admin template</title>

    <link
      rel="shortcut icon"
      type="image/x-icon"
      href="assets/img/favicon.jpg"
    />

    <link rel="stylesheet" href="assets/css/bootstrap.min.css" />

    <link rel="stylesheet" href="assets/css/animate.css" />

    <link rel="stylesheet" href="assets/css/dataTables.bootstrap4.min.css" />

    <link
      rel="stylesheet"
      href="assets/plugins/fontawesome/css/fontawesome.min.css"
    />
    <link rel="stylesheet" href="assets/plugins/fontawesome/css/all.min.css" />

    <link rel="stylesheet" href="assets/css/style.css" />
  </head>
  <body>
    <div id="global-loader">
      <div class="whirly-loader"></div>
    </div>

    <div class="main-wrapper">
      <div class="header">
        <div class="header-left active">
          <a href="index.html" class="logo">
            <img src="#" alt="" />
          </a>
          <a href="index.html" class="logo-small">
            <img src="#" alt="" />
          </a>
          <a id="toggle_btn" href="javascript:void(0);"> </a>
        </div>

        <a id="mobile_btn" class="mobile_btn" href="#sidebar">
          <span class="bar-icon">
            <span></span>
            <span></span>
            <span></span>
          </span>
        </a>

        <ul class="nav user-menu">
          <li class="nav-item">
            <div class="top-nav-search">
              <a href="javascript:void(0);" class="responsive-search">
                <i class="fa fa-search"></i>
              </a>
              <form action="#">
                <div class="searchinputs">
                  <input type="text" placeholder="Search Here ..." />
                  <div class="search-addon">
                    <span
                      ><img src="assets/img/icons/closes.svg" alt="img"
                    /></span>
                  </div>
                </div>
                <a class="btn" id="searchdiv"
                  ><img src="assets/img/icons/search.svg" alt="img"
                /></a>
              </form>
            </div>
          </li>

          <li class="nav-item dropdown has-arrow flag-nav">
            <a
              class="nav-link dropdown-toggle"
              data-bs-toggle="dropdown"
              href="javascript:void(0);"
              role="button"
            >
              <img src="assets/img/flags/us1.png" alt="" height="20" />
            </a>
            <div class="dropdown-menu dropdown-menu-right">
              <a href="javascript:void(0);" class="dropdown-item">
                <img src="assets/img/flags/us.png" alt="" height="16" /> English
              </a>
              <a href="javascript:void(0);" class="dropdown-item">
                <img src="assets/img/flags/fr.png" alt="" height="16" /> French
              </a>
              <a href="javascript:void(0);" class="dropdown-item">
                <img src="assets/img/flags/es.png" alt="" height="16" /> Spanish
              </a>
              <a href="javascript:void(0);" class="dropdown-item">
                <img src="assets/img/flags/de.png" alt="" height="16" /> German
              </a>
            </div>
          </li>

          <li class="nav-item dropdown">
            <a
              href="javascript:void(0);"
              class="dropdown-toggle nav-link"
              data-bs-toggle="dropdown"
            >
              <img src="assets/img/icons/notification-bing.svg" alt="img" />
              <span class="badge rounded-pill">4</span>
            </a>
            <div class="dropdown-menu notifications">
              <div class="topnav-dropdown-header">
                <span class="notification-title">Notifications</span>
                <a href="javascript:void(0)" class="clear-noti"> Clear All </a>
              </div>
              <div class="noti-content">
                <ul class="notification-list">
                  <li class="notification-message">
                    <a href="activities.html">
                      <div class="media d-flex">
                        <span class="avatar flex-shrink-0">
                          <img alt="" src="assets/img/profiles/avatar-02.jpg" />
                        </span>
                        <div class="media-body flex-grow-1">
                          <p class="noti-details">
                            <span class="noti-title">John Doe</span> added new
                            task
                            <span class="noti-title"
                              >Patient appointment booking</span
                            >
                          </p>
                          <p class="noti-time">
                            <span class="notification-time">4 mins ago</span>
                          </p>
                        </div>
                      </div>
                    </a>
                  </li>
                  <li class="notification-message">
                    <a href="activities.html">
                      <div class="media d-flex">
                        <span class="avatar flex-shrink-0">
                          <img alt="" src="assets/img/profiles/avatar-03.jpg" />
                        </span>
                        <div class="media-body flex-grow-1">
                          <p class="noti-details">
                            <span class="noti-title">Tarah Shropshire</span>
                            changed the task name
                            <span class="noti-title"
                              >Appointment booking with payment gateway</span
                            >
                          </p>
                          <p class="noti-time">
                            <span class="notification-time">6 mins ago</span>
                          </p>
                        </div>
                      </div>
                    </a>
                  </li>
                  <li class="notification-message">
                    <a href="activities.html">
                      <div class="media d-flex">
                        <span class="avatar flex-shrink-0">
                          <img alt="" src="assets/img/profiles/avatar-06.jpg" />
                        </span>
                        <div class="media-body flex-grow-1">
                          <p class="noti-details">
                            <span class="noti-title">Misty Tison</span> added
                            <span class="noti-title">Domenic Houston</span> and
                            <span class="noti-title">Claire Mapes</span> to
                            project
                            <span class="noti-title"
                              >Doctor available module</span
                            >
                          </p>
                          <p class="noti-time">
                            <span class="notification-time">8 mins ago</span>
                          </p>
                        </div>
                      </div>
                    </a>
                  </li>
                  <li class="notification-message">
                    <a href="activities.html">
                      <div class="media d-flex">
                        <span class="avatar flex-shrink-0">
                          <img alt="" src="assets/img/profiles/avatar-17.jpg" />
                        </span>
                        <div class="media-body flex-grow-1">
                          <p class="noti-details">
                            <span class="noti-title">Rolland Webber</span>
                            completed task
                            <span class="noti-title"
                              >Patient and Doctor video conferencing</span
                            >
                          </p>
                          <p class="noti-time">
                            <span class="notification-time">12 mins ago</span>
                          </p>
                        </div>
                      </div>
                    </a>
                  </li>
                  <li class="notification-message">
                    <a href="activities.html">
                      <div class="media d-flex">
                        <span class="avatar flex-shrink-0">
                          <img alt="" src="assets/img/profiles/avatar-13.jpg" />
                        </span>
                        <div class="media-body flex-grow-1">
                          <p class="noti-details">
                            <span class="noti-title">Bernardo Galaviz</span>
                            added new task
                            <span class="noti-title">Private chat module</span>
                          </p>
                          <p class="noti-time">
                            <span class="notification-time">2 days ago</span>
                          </p>
                        </div>
                      </div>
                    </a>
                  </li>
                </ul>
              </div>
              <div class="topnav-dropdown-footer">
                <a href="activities.html">View all Notifications</a>
              </div>
            </div>
          </li>

          <li class="nav-item dropdown has-arrow main-drop">
            <a
              href="javascript:void(0);"
              class="dropdown-toggle nav-link userset"
              data-bs-toggle="dropdown"
            >
              <span class="user-img"
                ><img src="assets/img/profiles/avator1.jpg" alt="" />
                <span class="status online"></span
              ></span>
            </a>
            <div class="dropdown-menu menu-drop-user">
              <div class="profilename">
                <div class="profileset">
                  <span class="user-img"
                    ><img src="assets/img/profiles/avator1.jpg" alt="" />
                    <span class="status online"></span
                  ></span>
                  <div class="profilesets">
                    <h6>John Doe</h6>
                    <h5>Admin</h5>
                  </div>
                </div>
                <hr class="m-0" />
                <a class="dropdown-item" href="profile.html">
                  <i class="me-2" data-feather="user"></i> My Profile</a
                >
                <a class="dropdown-item" href="generalsettings.html"
                  ><i class="me-2" data-feather="settings"></i>Settings</a
                >
                <hr class="m-0" />
                <a class="dropdown-item logout pb-0" href="login.html"
                  ><img
                    src="assets/img/icons/log-out.svg"
                    class="me-2"
                    alt="img"
                  />Logout</a
                >
              </div>
            </div>
          </li>
        </ul>

        <div class="dropdown mobile-user-menu">
          <a
            href="javascript:void(0);"
            class="nav-link dropdown-toggle"
            data-bs-toggle="dropdown"
            aria-expanded="false"
            ><i class="fa fa-ellipsis-v"></i
          ></a>
          <div class="dropdown-menu dropdown-menu-right">
            <a class="dropdown-item" href="profile.html">My Profile</a>
            <a class="dropdown-item" href="generalsettings.html">Settings</a>
            <a class="dropdown-item" href="login.html">Logout</a>
          </div>
        </div>
      </div>

      <div class="sidebar" id="sidebar">
        <div class="sidebar-inner slimscroll">
          <div id="sidebar-menu" class="sidebar-menu">
            <ul>
              <li class="active">
                <a href="index.html"
                  ><img src="assets/img/icons/dashboard.svg" alt="img" /><span>
                    Dashboard</span
                  >
                </a>
              </li>
              <li class="submenu">
                <a href="javascript:void(0);"
                  ><img src="assets/img/icons/product.svg" alt="img" /><span>
                    Inventory</span
                  >
                  <span class="menu-arrow"></span
                ></a>
                <ul>
                  <li><a href="productlist.html">Inventory List</a></li>
                  <li><a href="addproduct.html">Add Inventory</a></li>
                  <li><a href="categorylist.html">Category List</a></li>
                  <li><a href="addcategory.html">Add Category</a></li>
                  <li><a href="subcategorylist.html">Sub Category List</a></li>
                  <li><a href="subaddcategory.html">Add Sub Category</a></li>
                </ul>
              </li>
              <li class="submenu">
                <a href="javascript:void(0);"
                  ><img src="assets/img/icons/sales1.svg" alt="img" /><span>
                    Events</span
                  >
                  <span class="menu-arrow"></span
                ></a>
                <ul>
                  <li><a href="saleslist.html">Events List</a></li>
                  <li><a href="addevent.html">New Event</a></li>
                </ul>
              </li>

              <li class="submenu">
                <a href="javascript:void(0);"
                  ><img src="assets/img/icons/return1.svg" alt="img" /><span>
                    Return</span
                  >
                  <span class="menu-arrow"></span
                ></a>
                <ul>
                  <li>
                    <a href="salesreturnlist.html">Inventory Return List</a>
                  </li>
                  <li>
                    <a href="createsalesreturn.html">Add Inventory Return </a>
                  </li>
                </ul>
              </li>

              
              
              <li class="submenu">
                <a href="javascript:void(0);"
                  ><img src="assets/img/icons/settings.svg" alt="img" /><span>
                    Settings</span
                  >
                  <span class="menu-arrow"></span
                ></a>
                <ul>
                  <li><a href="generalsettings.html">General Settings</a></li>
                  <li><a href="emailsettings.html">Email Settings</a></li>
                  <li><a href="paymentsettings.html">Payment Settings</a></li>
                  <li><a href="currencysettings.html">Currency Settings</a></li>
                  <li><a href="grouppermissions.html">Group Permissions</a></li>
                  <li><a href="taxrates.html">Tax Rates</a></li>
                </ul>
              </li>
            </ul>
          </div>
        </div>
      </div>

      <div class="page-wrapper">
        <div class="content">
          <div class="row">
            <div class="col-lg-3 col-sm-6 col-12">
              <div class="dash-widget">
                <div class="dash-widgetimg">
                  <span
                    ><img src="assets/img/icons/dash1.svg" alt="img"
                  /></span>
                </div>
                <div class="dash-widgetcontent">
                  <h5><span class="counters" data-count="10">10</span></h5>
                  <h6>Total Categories</h6>
                </div>
              </div>
            </div>
            <div class="col-lg-3 col-sm-6 col-12">
              <div class="dash-widget dash1">
                <div class="dash-widgetimg">
                  <span
                    ><img src="assets/img/icons/dash2.svg" alt="img"
                  /></span>
                </div>
                <div class="dash-widgetcontent">
                  <h5><span class="counters" data-count="100">100</span></h5>
                  <h6>Total Inventory</h6>
                </div>
              </div>
            </div>
            <div class="col-lg-3 col-sm-6 col-12">
              <div class="dash-widget dash2">
                <div class="dash-widgetimg">
                  <span
                    ><img src="assets/img/icons/dash3.svg" alt="img"
                  /></span>
                </div>
                <div class="dash-widgetcontent">
                  <h5><span class="counters" data-count="20">20</span></h5>
                  <h6>Total Inventory In use</h6>
                </div>
              </div>
            </div>
            <div class="col-lg-3 col-sm-6 col-12">
              <div class="dash-widget dash3">
                <div class="dash-widgetimg">
                  <span
                    ><img src="assets/img/icons/dash4.svg" alt="img"
                  /></span>
                </div>
                <div class="dash-widgetcontent">
                  <h5><span class="counters" data-count="80">80</span></h5>
                  <h6>Inventory Not in use</h6>
                </div>
              </div>
            </div>

            <div class="row">
              <!-- Recent Events Card -->
              <div class="col-lg-7 col-sm-12 col-12 d-flex">
                <div class="card flex-fill">
                  <div
                    class="card-header pb-0 d-flex justify-content-between align-items-center"
                  >
                    <h5 class="card-title mb-0">Recent Events</h5>
                    <div class="graph-sets">
                      <div class="dropdown">
                        <button
                          class="btn btn-white btn-sm dropdown-toggle"
                          type="button"
                          id="timeFilterDropdown"
                          data-bs-toggle="dropdown"
                          aria-expanded="false"
                        >
                          <span id="selectedTimeFilter">Last 30 days</span>
                          <img
                            src="assets/img/icons/dropdown.svg"
                            alt="img"
                            class="ms-2"
                          />
                        </button>
                        <ul
                          class="dropdown-menu"
                          aria-labelledby="timeFilterDropdown"
                        >
                          <li>
                            <a href="javascript:void(0);" class="dropdown-item time-filter" data-value="7">Last 7 days</a>
                          </li>
                          <li>
                            <a href="javascript:void(0);" class="dropdown-item time-filter" data-value="30">Last 30 days</a>
                          </li>
                          <li>
                            <a href="javascript:void(0);" class="dropdown-item time-filter" data-value="90">Last 3 months</a>
                          </li>
                          <li>
                            <a href="javascript:void(0);" class="dropdown-item time-filter" data-value="365">Last year</a>
                          </li>
                        </ul>
                      </div>
                    </div>
                  </div>
                  <div class="card-body">
                    <div class="table-responsive">
                      <table class="table datatable-events">
                        <thead>
                          <tr>
                            <th>Event Name</th>
                            <th>Date</th>
                            <th>Status</th>
                            <th>Items Used</th>
                          </tr>
                        </thead>
                        <tbody id="recentEventsTableBody">
                          <!-- Events will be loaded here dynamically -->
                          <tr>
                            <td colspan="4" class="text-center">Loading events...</td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>
              
              <!-- Event Products Card -->
              <div class="col-lg-5 col-sm-12 col-12 d-flex">
                <div class="card flex-fill">
                  <div
                    class="card-header pb-0 d-flex justify-content-between align-items-center"
                  >
                    <h5 class="card-title mb-0">Popular Event Items</h5>
                    <div class="dropdown">
                      <a
                        href="javascript:void(0);"
                        data-bs-toggle="dropdown"
                        aria-expanded="false"
                        class="dropset"
                      >
                        <i class="fa fa-ellipsis-v"></i>
                      </a>
                      <ul
                        class="dropdown-menu"
                        aria-labelledby="dropdownMenuButton"
                      >
                        <li>
                          <a href="productlist.html" class="dropdown-item"
                            >Inventory List</a
                          >
                        </li>
                        <li>
                          <a href="saleslist.html" class="dropdown-item"
                            >Events List</a
                          >
                        </li>
                      </ul>
                    </div>
                  </div>
                  <div class="card-body">
                    <div class="table-responsive dataview">
                      <table class="table datatable-products">
                        <thead>
                          <tr>
                            <th>Product</th>
                            <th>Usage Count</th>
                          </tr>
                        </thead>
                        <tbody id="popularProductsTableBody">
                          <!-- Products will be loaded here dynamically -->
                          <tr>
                            <td colspan="2" class="text-center">Loading popular items...</td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script src="assets/js/jquery-3.6.0.min.js"></script>

    <script src="assets/js/feather.min.js"></script>

    <script src="assets/js/jquery.slimscroll.min.js"></script>

    <script src="assets/js/jquery.dataTables.min.js"></script>
    <script src="assets/js/dataTables.bootstrap4.min.js"></script>

    <script src="assets/js/bootstrap.bundle.min.js"></script>

    <script src="assets/js/script.js"></script>
    <script type="module">
      // This should be added to your module script section
      import { auth, db } from "./assets/js/firebase.js";
      import {
        onAuthStateChanged,
        signOut,
      } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-auth.js";
      import {
        doc,
        getDoc,
        collection,
        getDocs,
        query,
        orderBy,
        limit,
        where,
        Timestamp
      } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-firestore.js";

      // Function to load dashboard statistics
      async function loadDashboardStats() {
        try {
          // Get counts for various statistics
          const categoriesSnapshot = await getDocs(
            collection(db, "categories")
          );
          const categoriesCount = categoriesSnapshot.size;

          const inventorySnapshot = await getDocs(collection(db, "products"));
          const inventoryCount = inventorySnapshot.size;

          // Count items in use vs not in use
          const inUseQuery = query(
            collection(db, "inventory"),
            where("status", "==", "in_use")
          );
          const inUseSnapshot = await getDocs(inUseQuery);
          const inUseCount = inUseSnapshot.size;

          const notInUseCount = inventoryCount - inUseCount;

          // Update the counters in the UI
          document.querySelector('.counters[data-count="10"]').textContent =
            categoriesCount;
          document.querySelector('.counters[data-count="100"]').textContent =
            inventoryCount;
          document.querySelector('.counters[data-count="20"]').textContent =
            inUseCount;
          document.querySelector('.counters[data-count="80"]').textContent =
            notInUseCount;

          // Update the dashboard titles as well
          updateDashboardTitles(
            categoriesCount,
            inventoryCount,
            inUseCount,
            notInUseCount
          );

          // Load recent events
          loadRecentEvents(30); // Default to last 30 days
          
          // Load popular products
          loadPopularProducts();
        } catch (error) {
          console.error("Error loading dashboard statistics:", error);
        }
      }

      // Function to update dashboard titles
      function updateDashboardTitles(
        categoriesCount,
        inventoryCount,
        inUseCount,
        notInUseCount
      ) {
        const dashWidgetContents = document.querySelectorAll(
          ".dash-widgetcontent h6"
        );

        // Make sure we have the right elements and update them
        if (dashWidgetContents.length >= 4) {
          dashWidgetContents[0].textContent = "Total Categories";
          dashWidgetContents[1].textContent = "Total Inventory";
          dashWidgetContents[2].textContent = "Total Inventory In use";
          dashWidgetContents[3].textContent = "Inventory Not in use";
        }
      }

      // Function to format date
      function formatDate(timestamp) {
        if (!timestamp) return 'N/A';
        
        const date = timestamp.toDate ? timestamp.toDate() : new Date(timestamp);
        return date.toLocaleDateString('en-US', {
          year: 'numeric',
          month: 'short',
          day: 'numeric'
        });
      }

      // Function to load recent events
      async function loadRecentEvents(days = 30) {
        try {
          const tableBody = document.getElementById('recentEventsTableBody');
          tableBody.innerHTML = '<tr><td colspan="4" class="text-center">Loading events...</td></tr>';
          
          // Calculate the date range
          const endDate = new Date();
          const startDate = new Date();
          startDate.setDate(startDate.getDate() - days);
          
          // Create Firestore timestamps
          const startTimestamp = Timestamp.fromDate(startDate);
          const endTimestamp = Timestamp.fromDate(endDate);
          
          // Query events within the date range
          const eventsQuery = query(
            collection(db, "events"),
            where("eventDate", ">=", startTimestamp),
            where("eventDate", "<=", endTimestamp),
            orderBy("eventDate", "desc"),
            limit(10)
          );
          
          const eventsSnapshot = await getDocs(eventsQuery);
          
          if (eventsSnapshot.empty) {
            tableBody.innerHTML = '<tr><td colspan="4" class="text-center">No events found for the selected period</td></tr>';
            return;
          }
          
          tableBody.innerHTML = '';
          
          // Process each event
          for (const doc of eventsSnapshot.docs) {
            const event = doc.data();
            
            // Get the count of items used for this event
            let itemCount = 0;
            try {
              const eventProductsQuery = query(
                collection(db, "eventsProducts"),
                where("eventId", "==", doc.id)
              );
              const eventProductsSnapshot = await getDocs(eventProductsQuery);
              itemCount = eventProductsSnapshot.size;
            } catch (error) {
              console.error(`Error getting item count for event ${doc.id}:`, error);
            }
            
            // Create row for this event
            const row = document.createElement('tr');
            row.innerHTML = `
              <td><a href="saleslist.html?id=${doc.id}">${event.name || 'Unnamed Event'}</a></td>
              <td>${formatDate(event.eventDate)}</td>
              <td><span class="badges ${getStatusBadgeClass(event.status)}">${event.status || 'Pending'}</span></td>
              <td>${itemCount}</td>
            `;
            
            tableBody.appendChild(row);
          }
        } catch (error) {
          console.error("Error loading recent events:", error);
          const tableBody = document.getElementById('recentEventsTableBody');
          tableBody.innerHTML = '<tr><td colspan="4" class="text-center">Error loading events</td></tr>';
        }
      }
      
      // Helper function to get badge class based on status
      function getStatusBadgeClass(status) {
        switch (status?.toLowerCase()) {
          case 'completed':
            return 'bg-lightgreen';
          case 'pending':
            return 'bg-lightyellow';
          case 'cancelled':
            return 'bg-lightred';
          case 'in progress':
            return 'bg-lightblue';
          default:
            return 'bg-lightyellow';
        }
      }

      // Function to load popular products
      // Function to load popular products
async function loadPopularProducts() {
  try {
    const tableBody = document.getElementById('popularProductsTableBody');
    tableBody.innerHTML = '<tr><td colspan="2" class="text-center">Loading popular items...</td></tr>';
    
    // Create a map to count product usage across all events
    const productUsageMap = new Map();
    
    // Get all event products
    const eventsProductsSnapshot = await getDocs(collection(db, "eventsProducts"));
    
    // If no products found
    if (eventsProductsSnapshot.empty) {
      tableBody.innerHTML = '<tr><td colspan="2" class="text-center">No products found</td></tr>';
      return;
    }
    
    // Count occurrences of each product
    for (const doc of eventsProductsSnapshot.docs) {
      const eventProduct = doc.data();
      const productId = eventProduct.productId;
      
      if (productId) {
        const currentCount = productUsageMap.get(productId) || 0;
        productUsageMap.set(productId, currentCount + 1);
      }
    }
    
    // Convert map to array and sort by usage count (descending)
    const productUsageArray = Array.from(productUsageMap.entries())
      .sort((a, b) => b[1] - a[1])
      .slice(0, 5); // Get top 5 products
    
    // If no products after processing
    if (productUsageArray.length === 0) {
      tableBody.innerHTML = '<tr><td colspan="2" class="text-center">No popular products found</td></tr>';
      return;
    }
    
    // Clear loading message
    tableBody.innerHTML = '';
    
    // Load product details and create table rows
    for (const [productId, usageCount] of productUsageArray) {
      // Get product details
      const productDoc = await getDoc(doc(db, "products", productId));
      
      if (productDoc.exists()) {
        const product = productDoc.data();
        
        // Create row
        const row = document.createElement('tr');
        row.innerHTML = `
          <td class="productimgname">
            <a href="productlist.html?id=${productId}" class="product-img">
              <img src="${product.image || 'assets/img/product/product1.jpg'}" alt="product">
            </a>
            <a href="productlist.html?id=${productId}">${product.name || 'Unnamed Product'}</a>
          </td>
          <td>${usageCount}</td>
        `;
        
        tableBody.appendChild(row);
      }
    }
  } catch (error) {
    console.error("Error loading popular products:", error);
    const tableBody = document.getElementById('popularProductsTableBody');
    tableBody.innerHTML = '<tr><td colspan="2" class="text-center">Error loading products</td></tr>';
  }
}

// Add event listeners for time filter dropdown
document.addEventListener('DOMContentLoaded', function() {
  // Load initial dashboard data
  loadDashboardStats();
  
  // Add event listeners to time filter options
  const timeFilters = document.querySelectorAll('.time-filter');
  timeFilters.forEach(filter => {
    filter.addEventListener('click', function(e) {
      e.preventDefault();
      const days = parseInt(this.dataset.value);
      const filterText = this.textContent;
      
      // Update selected filter text
      document.getElementById('selectedTimeFilter').textContent = filterText;
      
      // Reload events with selected time filter
      loadRecentEvents(days);
    });
  });
  
  // Check authentication status
  onAuthStateChanged(auth, (user) => {
    if (!user) {
      // Redirect to login if not authenticated
      window.location.href = 'login.html';
    }
  });
});
    </script>
  </body>
  </html>